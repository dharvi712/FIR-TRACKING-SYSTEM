<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart FIR Tracking System</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f3f4f6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2563eb; color: white; padding: 20px; margin-bottom: 20px; }
        .header h1 { font-size: 24px; }
        .nav { background: white; padding: 10px 0; margin-bottom: 20px; display: flex; gap: 10px; overflow-x: auto; }
        .nav button { padding: 10px 20px; border: none; background: white; cursor: pointer; border-bottom: 2px solid transparent; }
        .nav button.active { border-bottom-color: #2563eb; color: #2563eb; font-weight: bold; }
        .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 20px; margin-bottom: 20px; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        .search-box input { flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 4px; }
        .search-box button { padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-card h3 { color: #6b7280; font-size: 14px; margin-bottom: 5px; }
        .stat-card p { font-size: 24px; font-weight: bold; color: #2563eb; }
        .timeline { position: relative; padding-left: 40px; }
        .timeline::before { content: ''; position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: #d1d5db; }
        .timeline-item { position: relative; margin-bottom: 20px; }
        .timeline-dot { position: absolute; left: -33px; width: 16px; height: 16px; border-radius: 50%; }
        .timeline-dot.completed { background: #10b981; }
        .timeline-dot.current { background: #2563eb; }
        .timeline-dot.pending { background: #d1d5db; }
        .chat-container { height: 500px; display: flex; flex-direction: column; }
        .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        .chat-message { max-width: 70%; padding: 10px 15px; border-radius: 8px; }
        .chat-message.user { background: #2563eb; color: white; margin-left: auto; }
        .chat-message.bot { background: #f3f4f6; }
        .chat-input { display: flex; gap: 10px; padding: 15px; border-top: 1px solid #e5e7eb; }
        .chat-input input { flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 4px; }
        .chat-input button { padding: 10px 20px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .police-station { padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; }
        .police-station:hover { background: #f9fafb; }
        .notification { padding: 15px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; }
        .notification.unread { background: #eff6ff; border-color: #bfdbfe; }
        .hidden { display: none; }
        .emergency-btn { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: #dc2626; color: white; border: none; border-radius: 50%; font-size: 20px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .officer-info { display: flex; gap: 15px; align-items: center; margin: 20px 0; }
        .officer-avatar { width: 60px; height: 60px; background: #dbeafe; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: #2563eb; }
        .document-item { padding: 10px; background: #f9fafb; border-radius: 4px; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .upload-area { border: 2px dashed #d1d5db; border-radius: 8px; padding: 40px; text-align: center; cursor: pointer; }
        .upload-area:hover { background: #f9fafb; }
        .feedback-stars { display: flex; gap: 5px; font-size: 32px; cursor: pointer; margin: 20px 0; }
        .feedback-stars span { color: #d1d5db; }
        .feedback-stars span.active { color: #fbbf24; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 8px; }
        .form-group input, .form-group select, .form-group textarea { 
            width: 100%; 
            padding: 10px; 
            border: 1px solid #d1d5db; 
            border-radius: 4px; 
            font-family: inherit;
        }
        .btn { padding: 12px 24px; background: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn:hover { background: #1d4ed8; }
        .btn-secondary { background: #6b7280; }
        .btn-secondary:hover { background: #4b5563; }
        .success-message { background: #d1fae5; color: #065f46; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .error-message { background: #fee2e2; color: #991b1b; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .file-list { margin-top: 20px; }
        .file-item { padding: 10px; background: #f9fafb; border-radius: 4px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .file-item button { background: #dc2626; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Smart FIR Tracking System</h1>
        </div>
    </div>

    <div class="container">
        <div class="nav" id="navBar"></div>
        <div id="content"></div>
    </div>

    <button class="emergency-btn" onclick="dialEmergency()">112</button>

    <script>
        // ============================================
        // DATA LAYER - User Submitted FIRs Storage
        // ============================================
        
        let userFIRs = JSON.parse(localStorage.getItem('userFIRs')) || {
            '2024/ROH/1234': {
                number: '2024/ROH/1234',
                type: 'Theft',
                name: 'Demo User',
                phone: '+91-9876543210',
                status: 'Under Investigation',
                progress: 60,
                officer: {
                    name: 'Inspector Rajesh Singh',
                    badge: 'ROH-4523',
                    phone: '+91-9876543210',
                    email: 'r.singh@haryana.police.gov.in'
                },
                station: 'Sector 14 Police Station, Rohtak',
                filedDate: '2024-12-20',
                lastUpdate: '2024-12-23',
                description: 'Mobile phone stolen from market area',
                timeline: [
                    { stage: 'FIR Filed', date: '2024-12-20', status: 'completed' },
                    { stage: 'Officer Assigned', date: '2024-12-20', status: 'completed' },
                    { stage: 'Investigation Started', date: '2024-12-21', status: 'completed' },
                    { stage: 'Evidence Collection', date: '2024-12-23', status: 'current' },
                    { stage: 'Report Preparation', date: 'Pending', status: 'pending' },
                    { stage: 'Case Closure', date: 'Pending', status: 'pending' }
                ],
                avgTime: '45-60 days',
                documents: ['FIR Copy', 'Evidence Photos', 'Witness Statement'],
                evidence: []
            }
        };

        const policeStations = [
            { id: 1, name: 'Sector 14 Police Station', lat: 28.8955, lng: 76.6066, cases: 45, officer: 'SI Kumar', address: 'Sector 14, Rohtak, Haryana' },
            { id: 2, name: 'Civil Lines Police Station', lat: 28.8845, lng: 76.6156, cases: 62, officer: 'SI Sharma', address: 'Civil Lines, Rohtak, Haryana' },
            { id: 3, name: 'Model Town Police Station', lat: 28.9055, lng: 76.5966, cases: 38, officer: 'SI Verma', address: 'Model Town, Rohtak, Haryana' }
        ];

        let userNotifications = JSON.parse(localStorage.getItem('userNotifications')) || [
            { id: 1, text: 'Welcome to Smart FIR Tracking System', time: 'Just now', read: false }
        ];

        const chatResponses = {
            'theft': 'For theft cases, you need: 1) Details of stolen items with photos if available, 2) Time and location, 3) Any witness information, 4) Identity proof. Visit your nearest police station or file online.',
            'cyber': 'For cyber fraud: 1) Save all transaction details, 2) Screenshot conversations, 3) Bank statements, 4) File at cybercrime.gov.in or visit Cyber Cell. Act quickly!',
            'documents': 'Required documents: 1) Identity proof (Aadhaar/PAN/Driving License), 2) Address proof, 3) Evidence related to crime, 4) Witness details if any.',
            'status': 'Enter your FIR number in the Track FIR section to see real-time status updates.',
            'time': 'Average case resolution time: Theft (45-60 days), Cyber Crime (60-90 days), Assault (30-45 days). Your case timeline may vary.',
            'file': 'To file a new FIR, go to the "File New FIR" tab and fill in all required details. You can also visit your nearest police station.',
            'track': 'To track your FIR, enter your FIR number in the search box on the dashboard. You will see real-time updates and progress.',
            'help': 'I can help you with: filing FIR, tracking status, required documents, nearby police stations, and general queries. What do you need help with?'
        };

        // ============================================
        // STATE MANAGEMENT
        // ============================================
        
        let appState = {
            activeTab: 'dashboard',
            currentFIR: userFIRs['2024/ROH/1234'],
            firNumber: '',
            chatMessages: [
                { sender: 'bot', text: 'Hello! How can I help you with filing or tracking your FIR? Try asking about "theft", "cyber crime", "documents", or "file FIR".' }
            ],
            selectedStation: null,
            rating: 0,
            uploadedFiles: []
        };

        // ============================================
        // CORE FUNCTIONS
        // ============================================

        function setState(newState) {
            appState = { ...appState, ...newState };
            render();
        }

        function saveToLocalStorage() {
            localStorage.setItem('userFIRs', JSON.stringify(userFIRs));
            localStorage.setItem('userNotifications', JSON.stringify(userNotifications));
        }

        function trackFIR() {
            const input = document.getElementById('firInput');
            const firNumber = input.value.trim();
            
            if (!firNumber) {
                showMessage('error', 'Please enter a FIR number');
                return;
            }
            
            if (userFIRs[firNumber]) {
                setState({ 
                    currentFIR: userFIRs[firNumber],
                    firNumber: firNumber,
                    activeTab: 'dashboard'
                });
                showMessage('success', 'FIR found! Displaying details...');
            } else {
                showMessage('error', 'FIR not found. Please check the number and try again.');
            }
        }

        function fileNewFIR(event) {
            event.preventDefault();
            
            const formData = {
                name: document.getElementById('firName').value,
                phone: document.getElementById('firPhone').value,
                email: document.getElementById('firEmail').value,
                type: document.getElementById('firType').value,
                station: document.getElementById('firStation').value,
                description: document.getElementById('firDescription').value,
                location: document.getElementById('firLocation').value,
                dateTime: document.getElementById('firDateTime').value
            };

            // Validate
            if (!formData.name || !formData.phone || !formData.type || !formData.description) {
                showMessage('error', 'Please fill all required fields');
                return;
            }

            // Generate FIR number
            const year = new Date().getFullYear();
            const random = Math.floor(1000 + Math.random() * 9000);
            const firNumber = `${year}/ROH/${random}`;

            // Create new FIR
            const newFIR = {
                number: firNumber,
                ...formData,
                status: 'Filed - Awaiting Assignment',
                progress: 10,
                officer: null,
                filedDate: new Date().toISOString().split('T')[0],
                lastUpdate: new Date().toISOString().split('T')[0],
                timeline: [
                    { stage: 'FIR Filed', date: new Date().toISOString().split('T')[0], status: 'completed' },
                    { stage: 'Officer Assignment', date: 'Pending', status: 'pending' },
                    { stage: 'Investigation', date: 'Pending', status: 'pending' },
                    { stage: 'Evidence Collection', date: 'Pending', status: 'pending' },
                    { stage: 'Report Preparation', date: 'Pending', status: 'pending' },
                    { stage: 'Case Closure', date: 'Pending', status: 'pending' }
                ],
                avgTime: '45-60 days',
                documents: ['FIR Copy'],
                evidence: []
            };

            // Save to storage
            userFIRs[firNumber] = newFIR;
            saveToLocalStorage();

            // Add notification
            addNotification(`FIR #${firNumber} filed successfully! Your case is being processed.`);

            // Show success
            showMessage('success', `FIR Filed Successfully! Your FIR Number is: ${firNumber}. Please save this for tracking.`);

            // Clear form
            document.getElementById('newFIRForm').reset();

            // Switch to dashboard
            setTimeout(() => {
                setState({ 
                    currentFIR: newFIR,
                    firNumber: firNumber,
                    activeTab: 'dashboard'
                });
            }, 3000);
        }

        function addNotification(text) {
            userNotifications.unshift({
                id: Date.now(),
                text: text,
                time: 'Just now',
                read: false
            });
            saveToLocalStorage();
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;

            appState.chatMessages.push({ sender: 'user', text: message });
            render();

            setTimeout(() => {
                let response = "I understand your concern. For specific legal advice, please consult with a legal expert. You can also call the national helpline: 112 for emergencies.";
                
                const lowerMessage = message.toLowerCase();
                for (const [key, value] of Object.entries(chatResponses)) {
                    if (lowerMessage.includes(key)) {
                        response = value;
                        break;
                    }
                }
                
                appState.chatMessages.push({ sender: 'bot', text: response });
                render();
                
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }, 1000);

            input.value = '';
        }

        function setRating(stars) {
            setState({ rating: stars });
        }

        function submitFeedback() {
            const feedback = document.getElementById('feedbackText').value;
            const rating = appState.rating;

            if (!rating) {
                showMessage('error', 'Please select a rating');
                return;
            }

            if (!feedback) {
                showMessage('error', 'Please enter your feedback');
                return;
            }

            addNotification(`Thank you for your ${rating}-star feedback! We value your input.`);
            showMessage('success', 'Feedback submitted successfully! Thank you.');
            
            document.getElementById('feedbackText').value = '';
            setState({ rating: 0 });
        }

        function handleFileUpload(event) {
            const files = event.target.files;
            
            for (let file of files) {
                if (file.size > 10 * 1024 * 1024) {
                    showMessage('error', `File ${file.name} is too large. Max size is 10MB.`);
                    continue;
                }

                const fileData = {
                    name: file.name,
                    size: (file.size / 1024).toFixed(2) + ' KB',
                    type: file.type,
                    uploadDate: new Date().toISOString().split('T')[0]
                };

                appState.uploadedFiles.push(fileData);
                
                if (appState.currentFIR) {
                    if (!appState.currentFIR.evidence) {
                        appState.currentFIR.evidence = [];
                    }
                    appState.currentFIR.evidence.push(fileData);
                    userFIRs[appState.currentFIR.number] = appState.currentFIR;
                    saveToLocalStorage();
                }
            }

            showMessage('success', `${files.length} file(s) uploaded successfully!`);
            render();
        }

        function removeFile(index) {
            appState.uploadedFiles.splice(index, 1);
            
            if (appState.currentFIR && appState.currentFIR.evidence) {
                appState.currentFIR.evidence.splice(index, 1);
                userFIRs[appState.currentFIR.number] = appState.currentFIR;
                saveToLocalStorage();
            }
            
            render();
        }

        function showMessage(type, message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            const content = document.getElementById('content');
            content.insertBefore(messageDiv, content.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        function dialEmergency() {
            if (confirm('Dial Emergency Number 112?\n\nThis will call emergency services.')) {
                alert('In a real app, this would dial 112.\n\nFor demo purposes, please dial 112 manually if you have an emergency.');
            }
        }

        function markNotificationRead(id) {
            const notif = userNotifications.find(n => n.id === id);
            if (notif) {
                notif.read = true;
                saveToLocalStorage();
                render();
            }
        }

        // ============================================
        // RENDER FUNCTIONS
        // ============================================

        function renderNavigation() {
            const tabs = [
                { id: 'dashboard', label: 'Track FIR' },
                { id: 'fileFIR', label: 'File New FIR' },
                { id: 'map', label: 'Police Stations' },
                { id: 'chatbot', label: 'FIR Assistant' },
                { id: 'notifications', label: 'Notifications' },
                { id: 'evidence', label: 'Evidence Upload' },
                { id: 'feedback', label: 'Feedback' }
            ];

            return tabs.map(tab => `
                <button 
                    class="${appState.activeTab === tab.id ? 'active' : ''}"
                    onclick="setState({ activeTab: '${tab.id}' })"
                >
                    ${tab.label}
                </button>
            `).join('');
        }

        function renderDashboard() {
            const fir = appState.currentFIR;
            
            return `
                <div class="card search-box">
                    <input 
                        type="text" 
                        id="firInput"
                        placeholder="Enter FIR Number (e.g., 2024/ROH/1234)"
                        value="${appState.firNumber}"
                    >
                    <button onclick="trackFIR()">Track FIR</button>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <h3>FIR Status</h3>
                        <p>${fir.status}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Progress</h3>
                        <p style="color: #10b981">${fir.progress}%</p>
                    </div>
                    <div class="stat-card">
                        <h3>Expected Time</h3>
                        <p style="color: #f59e0b">${fir.avgTime}</p>
                    </div>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 15px">FIR Details</h2>
                    <p><strong>FIR Number:</strong> ${fir.number}</p>
                    <p><strong>Type:</strong> ${fir.type}</p>
                    <p><strong>Complainant:</strong> ${fir.name}</p>
                    <p><strong>Phone:</strong> ${fir.phone}</p>
                    <p><strong>Filed Date:</strong> ${fir.filedDate}</p>
                    <p><strong>Station:</strong> ${fir.station}</p>
                    <p style="margin-top: 10px"><strong>Description:</strong><br>${fir.description || 'N/A'}</p>
                </div>

                <div class="card">
                    <h2 style="margin-bottom: 20px">Case Timeline</h2>
                    <div class="timeline">
                        ${fir.timeline.map(item => `
                            <div class="timeline-item">
                                <div class="timeline-dot ${item.status}"></div>
                                <div>
                                    <strong>${item.stage}</strong><br>
                                    <span style="color: #6b7280; font-size: 14px">${item.date}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                ${fir.officer ? `
                <div class="card">
                    <h2 style="margin-bottom: 20px">Assigned Officer</h2>
                    <div class="officer-info">
                        <div class="officer-avatar">üëÆ</div>
                        <div>
                            <h3>${fir.officer.name}</h3>
                            <p style="color: #6b7280">Badge: ${fir.officer.badge}</p>
                        </div>
                    </div>
                    <div style="margin-top: 15px">
                        <p style="margin-bottom: 8px">üìû ${fir.officer.phone}</p>
                        <p style="margin-bottom: 8px">‚úâÔ∏è ${fir.officer.email}</p>
                    </div>
                </div>
                ` : '<div class="card"><p>Officer not yet assigned. You will be notified once an officer is assigned to your case.</p></div>'}

                <div class="card">
                    <h2 style="margin-bottom: 20px">Documents</h2>
                    ${fir.documents.map(doc => `
                        <div class="document-item">
                            <span>üìÑ ${doc}</span>
                            <button style="background: none; border: none; color: #2563eb; cursor: pointer">Download</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderFileFIR() {
            return `
                <div class="card">
                    <h2 style="margin-bottom: 20px">File New FIR</h2>
                    <form id="newFIRForm" onsubmit="fileNewFIR(event); return false;">
                        <div class="form-group">
                            <label>Full Name *</label>
                            <input type="text" id="firName" placeholder="Enter your full name" required>
                        </div>

                        <div class="form-group">
                            <label>Phone Number *</label>
                            <input type="tel" id="firPhone" placeholder="+91-XXXXXXXXXX" required>
                        </div>

                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="firEmail" placeholder="your.email@example.com">
                        </div>

                        <div class="form-group">
                            <label>Crime Type *</label>
                            <select id="firType" required>
                                <option value="">Select crime type</option>
                                <option value="Theft">Theft</option>
                                <option value="Robbery">Robbery</option>
                                <option value="Cyber Crime">Cyber Crime</option>
                                <option value="Fraud">Fraud</option>
                                <option value="Assault">Assault</option>
                                <option value="Domestic Violence">Domestic Violence</option>
                                <option value="Harassment">Harassment</option>
                                <option value="Missing Person">Missing Person</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Police Station *</label>
                            <select id="firStation" required>
                                <option value="">Select police station</option>
                                ${policeStations.map(station => `
                                    <option value="${station.name}">${station.name}</option>
                                `).join('')}
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Incident Location</label>
                            <input type="text" id="firLocation" placeholder="Where did the incident occur?">
                        </div>

                        <div class="form-group">
                            <label>Date & Time of Incident</label>
                            <input type="datetime-local" id="firDateTime">
                        </div>

                        <div class="form-group">
                            <label>Detailed Description *</label>
                            <textarea id="firDescription" rows="5" placeholder="Describe the incident in detail..." required></textarea>
                        </div>

                        <button type="submit" class="btn">Submit FIR</button>
                        <button type="reset" class="btn btn-secondary" style="margin-left: 10px">Clear Form</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 10px">Important Information</h3>
                    <ul style="padding-left: 20px; line-height: 1.8">
                        <li>Keep your FIR number safe for future tracking</li>
                        <li>You will receive notifications about case updates</li>
                        <li>Upload evidence in the "Evidence Upload" section</li>
                        <li>An officer will be assigned within 24-48 hours</li>
                        <li>For emergencies, call 112 immediately</li>
                    </ul>
                </div>
            `;
        }

        function renderMap() {
            return `
                <div class="card">
                    <h2 style="margin-bottom: 20px">Nearby Police Stations</h2>
                    <div style="background: #e5e7eb; height: 300px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px">
                        <span style="color: #6b7280; font-size: 18px">üó∫Ô∏è Map View (Rohtak, Haryana)</span>
                    </div>
                    
                    ${policeStations.map(station => `
                        <div class="police-station">
                            <h3>${station.name}</h3>
                            <p style="color: #6b7280; font-size: 14px; margin: 5px 0">üìç ${station.address}</p>
                            <p style="color: #6b7280; font-size: 14px; margin: 5px 0">Officer In-Charge: ${station.officer}</p>
                            <p style="color: #6b7280; font-size: 14px">Active Cases: ${station.cases}</p>
                            <button onclick="alert('Directions to ${station.name}\\n${station.address}')" style="margin-top: 10px; background: none; border: none; color: #2563eb; cursor: pointer">Get Directions ‚Üí</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderChatbot() {
            return `
                <div class="card chat-container">
                    <div style="padding: 15px; border-bottom: 1px solid #e5e7eb">
                        <h2>FIR Assistant</h2>
                        <p style="color: #6b7280; font-size: 14px">Ask anything about filing or tracking FIRs</p>
                    </div>
                    
                    <div class="chat-messages" id="chatMessages">
                        ${appState.chatMessages.map(msg => `
                            <div class="chat-message ${msg.sender}">
                                ${msg.text}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="chat-input">
                        <input 
                            type="text" 
                            id="chatInput"
                            placeholder="Type your question..."
                            onkeypress="if(event.key === 'Enter') sendChatMessage()"
                        >
                        <button onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            `;
        }

        function renderNotifications() {
            return `
                <div class="card">
                    <h2 style="margin-bottom: 20px">Notifications</h2>
                    ${userNotifications.length === 0 ? '<p>No notifications yet.</p>' : ''}
                    ${userNotifications.map(notif => `
                        <div class="notification ${!notif.read ? 'unread' : ''}" onclick="markNotificationRead(${notif.id})">
                            <div style="display: flex; justify-content: space-between; align-items: start">
                                <div>
                                    <p style="font-weight: 500; margin-bottom: 5px">${notif.text}</p>
                                    <p style="color: #6b7280; font-size: 14px">${notif.time}</p>
                                </div>
                                ${!notif.read ? '<span style="width: 8px; height: 8px; background: #2563eb; border-radius: 50%; display: inline-block"></span>' : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderEvidenceUpload() {
            const currentFIR = appState.currentFIR;
            const evidenceFiles = currentFIR && currentFIR.evidence ? currentFIR.evidence : [];
            
            return `
                <div class="card">
                    <h2 style="margin-bottom: 20px">Digital Evidence Locker</h2>
                    
                    ${currentFIR ? `<p style="margin-bottom: 15px">Uploading evidence for FIR: <strong>${currentFIR.number}</strong></p>` : ''}
                    
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div style="font-size: 48px; margin-bottom: 10px">üì§</div>
                        <p style="color: #6b7280; margin-bottom: 5px">Click to upload files</p>
                        <p style="color: #9ca3af; font-size: 14px">Supported: Images, Videos, Documents (Max 10MB)</p>
                        <input 
                            type="file" 
                            id="fileInput" 
                            multiple 
                            accept="image/*,video/*,.pdf,.doc,.docx" 
                            style="display: none"
                            onchange="handleFileUpload(event)"
                        >
                    </div>
                    
                    ${evidenceFiles.length > 0 ? `
                    <div class="file-list">
                        <h3 style="margin-bottom: 15px">Uploaded Evidence (${evidenceFiles.length})</h3>
                        ${evidenceFiles.map((file, index) => `
                            <div class="file-item">
                                <div>
                                    <strong>${file.name}</strong><br>
                                    <span style="color: #6b7280; font-size: 14px">${file.size} | Uploaded: ${file.uploadDate}</span>
                                </div>
                                <button onclick="removeFile(${index})">Remove</button>
                            </div>
                        `).join('')}
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function renderFeedback() {
            return `
                <div class="card">
                    <h2 style="margin-bottom: 20px">Feedback & Support</h2>
                    
                    <div style="margin-bottom: 20px">
                        <label style="display: block; font-weight: 500; margin-bottom: 10px">Rate Officer Behavior</label>
                        <div class="feedback-stars">
                            ${[1, 2, 3, 4, 5].map(star => `
                                <span 
                                    class="${star <= appState.rating ? 'active' : ''}"
                                    onclick="setRating(${star})"
                                >‚≠ê</span>
                            `).join('')}
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Your Feedback</label>
                        <textarea 
                            id="feedbackText"
                            rows="4"
                            placeholder="Share your experience..."
                        ></textarea>
                    </div>

                    <button onclick="submitFeedback()" class="btn">Submit Feedback</button>

                    <div style="margin-top: 30px; padding: 15px; background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px">
                        <h3 style="color: #991b1b; margin-bottom: 10px">Need to Escalate?</h3>
                        <p style="color: #b91c1c; font-size: 14px; margin-bottom: 15px">If you're not satisfied with the progress, you can escalate to senior officers.</p>
                        <button onclick="alert('Escalation request submitted. A senior officer will contact you within 24 hours.')" style="padding: 10px 20px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer">
                            Escalate Case
                        </button>
                    </div>
                </div>
            `;
        }

        // ============================================
        // MAIN RENDER FUNCTION
        // ============================================

        function render() {
            document.getElementById('navBar').innerHTML = renderNavigation();
            
            const contentMap = {
                'dashboard': renderDashboard,
                'fileFIR': renderFileFIR,
                'map': renderMap,
                'chatbot': renderChatbot,
                'notifications': renderNotifications,
                'evidence': renderEvidenceUpload,
                'feedback': renderFeedback
            };
            
            document.getElementById('content').innerHTML = contentMap[appState.activeTab]();
            
            if (appState.activeTab === 'chatbot') {
                setTimeout(() => {
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                }, 0);
            }
        }

        // ============================================
        // INITIALIZE APP
        // ============================================

        render();

    </script>
</body>
</html>